/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var T=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var ue=(r,a)=>{for(var t in a)T(r,t,{get:a[t],enumerable:!0})},ce=(r,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of le(a))!ie.call(r,n)&&n!==t&&T(r,n,{get:()=>a[n],enumerable:!(e=se(a,n))||e.enumerable});return r};var pe=r=>ce(T({},"__esModule",{value:!0}),r);var ke={};ue(ke,{default:()=>C});module.exports=pe(ke);var b=require("obsidian");var Z=require("obsidian");var f=require("obsidian");var me=/^(\d{4})-(\d{2})-(\d{2})$/;function h(r){let a=me.exec(r.trim());if(!a)return null;let t=Number(a[1]),e=Number(a[2])-1,n=Number(a[3]);if(isNaN(t)||isNaN(e)||isNaN(n))return null;let o=new Date(t,e,n);return o.setHours(0,0,0,0),o}var de=[/^(\d{4}-\d{2}-\d{2})/,/^(\d{4})\/(\d{2})\/(\d{2})/,/^(\w+ \d{1,2}, \d{4})/];function $(r){let a=r.replace(/\.md$/i,"");for(let t of de){let e=a.match(t);if(e){let n;e.length===4?n=`${e[1]}-${e[2]}-${e[3]}`:n=e[1];let o=h(n);if(o)return o;let s=new Date(n);if(!isNaN(s.getTime()))return s.setHours(0,0,0,0),s}}return null}function x(r){let a=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),e=String(r.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function O(r){var t;let a=(t=h(r))!=null?t:new Date(r);return isNaN(a.getTime())?r:a.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}function A(r,a){let t=[],e=new Date(r);e.setHours(0,0,0,0);let n=new Date(a);for(n.setHours(0,0,0,0);e<=n;)t.push(x(e)),e.setDate(e.getDate()+1);return t}function M(r,a){let t=r.getDay();return a===0?t:t===0?6:t-1}function S(r,a,t){let e=new Date(r);e.setHours(0,0,0,0);let n=new Date(a);n.setHours(0,0,0,0);let o=e.getTime()-n.getTime(),s=Math.floor(o/(1e3*60*60*24)),i=M(n,t);return Math.floor((s+i)/7)+1}function W(r,a,t){var o,s;let e,n;if(t?(n=(o=h(t))!=null?o:new Date(t),isNaN(n.getTime())&&(n=new Date)):n=new Date,n.setHours(0,0,0,0),a)e=(s=h(a))!=null?s:new Date(a),isNaN(e.getTime())&&(e=new Date(n.getFullYear(),0,1));else{let i=Array.from(r.keys()).map(c=>{var u;return(u=h(c))!=null?u:new Date(c)}).filter(c=>!isNaN(c.getTime())).sort((c,u)=>c.getTime()-u.getTime());i.length>0?e=i[0]:e=new Date(n.getFullYear(),0,1)}return e.setHours(0,0,0,0),{start:e,end:n}}function F(r,a,t){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Map,o=new Date(r);o.setHours(0,0,0,0);let s=new Date(a);for(s.setHours(0,0,0,0);o<=s;){let m=o.getMonth(),p=S(o,r,t),d=n.get(p);d||(d=new Set,n.set(p,d)),d.add(m),o.setDate(o.getDate()+1)}let i=[],c=S(s,r,t),u=-1,l=null;for(let m=1;m<=c;m++){let p=n.get(m);if(!p)continue;let d=Array.from(p).sort((y,D)=>y-D),g=d[d.length-1];g!==u&&(l&&(l.endColumn=m),l={name:e[g],startColumn:m,endColumn:c+1},i.push(l),u=g)}return l&&(l.endColumn=c+1),i}function z(r){let a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return r===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:a}function L(r){return r.includes(".")?r:`frontmatter.${r}`}function _(r,a){var s,i;if(a==="__filename__"||!a){let c=$(r.file.basename);return c?x(c):null}let t=L(a),e=r.getValue(t);if(e===null||e instanceof f.NullValue)return null;if(e instanceof f.DateValue){let c=e.toString(),u=(s=h(c))!=null?s:new Date(c);return isNaN(u.getTime())?null:x(u)}let n=e.toString(),o=(i=h(n))!=null?i:new Date(n);return isNaN(o.getTime())?null:x(o)}function fe(r,a){let t=L(a),e=r.getValue(t);if(e===null||e instanceof f.NullValue)return{value:null,displayValue:`${a}: not set`,type:"unsupported"};if(e instanceof f.BooleanValue){let o=e.isTruthy();return{value:o?1:0,displayValue:o?"Yes":"No",type:"boolean"}}if(e instanceof f.NumberValue){let o=Number(e.toString());return isNaN(o)?{value:null,displayValue:e.toString(),type:"unsupported"}:{value:o,displayValue:String(o),type:"number"}}if(e instanceof f.StringValue){let o=e.toString(),s=parseFloat(o);if(!isNaN(s))return{value:s,displayValue:o,type:"number"};let i=o.toLowerCase();return i==="true"||i==="yes"?{value:1,displayValue:"Yes",type:"boolean"}:i==="false"||i==="no"?{value:0,displayValue:"No",type:"boolean"}:{value:null,displayValue:o,type:"unsupported"}}return{value:e.isTruthy()?1:0,displayValue:e.toString(),type:"boolean"}}function B(r,a,t){let e=new Map,n=1/0,o=-1/0,s=0,i=!1;for(let c of r){let u=_(c,a);if(!u)continue;let{value:l,displayValue:m,type:p}=fe(c,t);p==="number"&&l!==null&&l!==0&&l!==1&&(i=!0),l!==null&&(n=Math.min(n,l),o=Math.max(o,l),s++);let d=e.get(u);d?l!==null&&(d.value===null||l>d.value)&&e.set(u,{date:u,value:l,note:c.file,displayValue:m}):e.set(u,{date:u,value:l,note:c.file,displayValue:m})}return n===1/0&&(n=0),o===-1/0&&(o=1),n===o&&n>0&&(n=0),{entries:e,stats:{min:n,max:o,count:s,hasNumeric:i}}}function R(r,a,t){let e=!1,n=!1,o=!1,s=L(a);for(let i of r){if(!_(i,t))continue;let u=i.getValue(s);if(!(u===null||u instanceof f.NullValue))if(o=!0,u instanceof f.BooleanValue)e=!0;else if(u instanceof f.NumberValue){let l=Number(u.toString());if(isNaN(l))return"unsupported";l!==0&&l!==1?n=!0:e=!0}else if(u instanceof f.StringValue){let l=u.toString(),m=parseFloat(l);if(!isNaN(m))m!==0&&m!==1?n=!0:e=!0;else{let p=l.toLowerCase();if(["true","false","yes","no"].includes(p))e=!0;else return"unsupported"}}else e=!0}return o?n?"number":e?"boolean":"unsupported":"unsupported"}var Y={green:{dark:{zero:"#161b22",max:"#39d353"},light:{zero:"#ebedf0",max:"#216e39"}},purple:{dark:{zero:"#1a1523",max:"#a78bfa"},light:{zero:"#ebedf0",max:"#5b21b6"}},blue:{dark:{zero:"#161b22",max:"#38bdf8"},light:{zero:"#ebedf0",max:"#0284c7"}},orange:{dark:{zero:"#1c1917",max:"#fb923c"},light:{zero:"#ebedf0",max:"#ea580c"}},gray:{dark:{zero:"#161b22",max:"#adbac7"},light:{zero:"#ebedf0",max:"#444c56"}}};function U(r){let a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:{r:0,g:0,b:0}}function ge(r,a,t){let e=n=>Math.max(0,Math.min(255,Math.round(n))).toString(16).padStart(2,"0");return`#${e(r)}${e(a)}${e(t)}`}function H(r){return r<=.0031308?r*12.92:1.055*Math.pow(r,1/2.4)-.055}function v(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function G(r,a,t){let e=v(r/255),n=v(a/255),o=v(t/255),s=.4122214708*e+.5363325363*n+.0514459929*o,i=.2119034982*e+.6806995451*n+.1073969566*o,c=.0883024619*e+.2817188376*n+.6299787005*o,u=Math.cbrt(s),l=Math.cbrt(i),m=Math.cbrt(c);return{L:.2104542553*u+.793617785*l-.0040720468*m,a:1.9779984951*u-2.428592205*l+.4505937099*m,b:.0259040371*u+.7827717662*l-.808675766*m}}function he(r,a,t){let e=r+.3963377774*a+.2158037573*t,n=r-.1055613458*a-.0638541728*t,o=r-.0894841775*a-1.291485548*t,s=e*e*e,i=n*n*n,c=o*o*o,u=4.0767416621*s-3.3077115913*i+.2309699292*c,l=-1.2684380046*s+2.6097574011*i-.3413193965*c,m=-.0041960863*s-.7034186147*i+1.707614701*c;return{r:Math.round(H(u)*255),g:Math.round(H(l)*255),b:Math.round(H(m)*255)}}function ye(r,a,t){let e=U(r),n=U(a),o=G(e.r,e.g,e.b),s=G(n.r,n.g,n.b),i=o.L+(s.L-o.L)*t,c=o.a+(s.a-o.a)*t,u=o.b+(s.b-o.b)*t,l=he(i,c,u);return ge(l.r,l.g,l.b)}function q(r,a,t){return t===a?1:r<=a?0:r>=t?1:(r-a)/(t-a)}function Q(r){return r?1:0}function J(r,a,t){let e=t?Y[a].dark:Y[a].light;if(r<=0)return e.zero;let n=Math.max(0,Math.min(1,r));return ye(e.zero,e.max,n)}function V(){return document.body.classList.contains("theme-dark")}function be(r,a,t){let e=a.get(r);if(!e)return{type:"empty"};if(e.value===null)return{type:"zero",note:e.note};let n;return t.hasNumeric?n=q(e.value,t.min,t.max):n=Q(e.value>0),{type:"filled",note:e.note,intensity:n}}function De(r,a,t,e,n,o){let s=document.createElement("div");s.className="heatmap-cell",s.dataset.date=r,s.style.gridRow=String(t),s.style.gridColumn=String(e);let i=V();return a.type==="empty"?s.classList.add("heatmap-cell--empty"):a.type==="zero"?(s.classList.add("heatmap-cell--zero"),s.dataset.notePath=a.note.path):a.type==="filled"&&(s.classList.add("heatmap-cell--filled"),s.dataset.notePath=a.note.path,s.dataset.intensity=String(a.intensity),s.style.backgroundColor=J(a.intensity,o,i)),n&&(s.dataset.displayValue=n.displayValue),s}function we(r,a){let t=document.createElement("div");t.className="heatmap-month-labels",t.style.setProperty("--total-weeks",String(a));for(let e of r){let n=document.createElement("span");n.className="heatmap-month-label",n.textContent=e.name,n.style.gridColumnStart=String(e.startColumn),n.style.gridColumnEnd=String(e.endColumn),t.appendChild(n)}return t}function Se(r){let a=document.createElement("div");a.className="heatmap-weekday-labels";let t=z(r),e=r===1?[0,2,4]:[1,3,5];for(let n=0;n<7;n++){let o=document.createElement("span");o.className="heatmap-weekday-label",e.includes(n)&&(o.textContent=t[n]),a.appendChild(o)}return a}function N(r,a){let t=document.createElement("div");t.className="heatmap-empty-state";let e=document.createElement("div");e.className="heatmap-empty-state-icon",e.textContent="\u26A0",t.appendChild(e);let n=document.createElement("div");n.className="heatmap-empty-state-title",n.textContent=r,t.appendChild(n);let o=document.createElement("div");return o.className="heatmap-empty-state-description",o.textContent=a,t.appendChild(o),t}function j(r,a,t){var P;let{entries:e,stats:n}=r,{colorScheme:o,weekStart:s,showWeekdayLabels:i,showMonthLabels:c}=t,u=A(a.start,a.end),l=F(a.start,a.end,s),m=S(a.end,a.start,s),p=document.createElement("div");p.className=`heatmap-container heatmap--${o}`,V()?p.classList.add("heatmap--dark"):p.classList.add("heatmap--light");let d=document.createElement("div");d.className="heatmap-scroll-wrapper";let g=document.createElement("div");g.className="heatmap-inner-wrapper",i&&g.classList.add("heatmap-inner-wrapper--with-labels"),c&&g.appendChild(we(l,m));let y=document.createElement("div");y.className="heatmap-grid",i&&y.appendChild(Se(s));let D=document.createElement("div");D.className="heatmap-cells";for(let w of u){let k=(P=h(w))!=null?P:new Date(w);if(isNaN(k.getTime()))continue;let te=M(k,s),ne=S(k,a.start,s),ae=be(w,e,n),re=e.get(w),oe=De(w,ae,te+1,ne,re,o);D.appendChild(oe)}return y.appendChild(D),g.appendChild(y),d.appendChild(g),p.appendChild(d),p}var K=require("obsidian");function X(r){let{app:a,entries:t,containerEl:e,plugin:n}=r,o=[],s=l=>{let p=l.target.closest(".heatmap-cell");if(!(p instanceof HTMLElement))return;let d=p.dataset.notePath;d&&a.workspace.openLinkText(d,"",!1)};e.addEventListener("click",s),o.push(()=>e.removeEventListener("click",s));let i=l=>{let p=l.target.closest(".heatmap-cell");if(!(p instanceof HTMLElement))return;let d=p.dataset.date;if(!d)return;let g=xe(d,t.get(d),p,n);(0,K.setTooltip)(p,g,{placement:"top"})};e.addEventListener("mouseover",i),o.push(()=>e.removeEventListener("mouseover",i));let c=l=>{let p=l.target.closest(".heatmap-cell");if(!(!(p instanceof HTMLElement)||!p.dataset.date)){if(l.key==="Enter"){let g=p.dataset.notePath;g&&a.workspace.openLinkText(g,"",!1)}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(l.key)&&(l.preventDefault(),Ee(p,l.key,e))}};return e.addEventListener("keydown",c),o.push(()=>e.removeEventListener("keydown",c)),e.querySelectorAll(".heatmap-cell").forEach(l=>{l.tabIndex=0}),()=>{o.forEach(l=>l())}}function xe(r,a,t,e){let n=O(r);if(!a)return`${n}
No note`;let o=t.dataset.displayValue||a.displayValue,s=t.style.backgroundColor?Ne(t.style.backgroundColor):"",i=e.settings.showHexColorInTooltip&&s?`
${s}`:"";return`${n}
${o}${i}`}function Ne(r){if(r.startsWith("#"))return r;let a=r.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!a)return r;let t=parseInt(a[1],10),e=parseInt(a[2],10),n=parseInt(a[3],10),o=s=>s.toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(n)}`}function Ee(r,a,t){var c;let e=r.dataset.date;if(!e)return;let n=(c=h(e))!=null?c:new Date(e);if(isNaN(n.getTime()))return;let o;switch(a){case"ArrowUp":o=new Date(n),o.setDate(n.getDate()-1);break;case"ArrowDown":o=new Date(n),o.setDate(n.getDate()+1);break;case"ArrowLeft":o=new Date(n),o.setDate(n.getDate()-7);break;case"ArrowRight":o=new Date(n),o.setDate(n.getDate()+7);break;default:return}let s=Ce(o),i=t.querySelector(`.heatmap-cell[data-date="${s}"]`);i instanceof HTMLElement&&i.focus()}function Ce(r){let a=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),e=String(r.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}var E=class extends Z.BasesView{constructor(t,e,n){super(t);this.plugin=n;this.type="heatmap";this.cleanupInteractions=null;this.processedData=null;this.containerEl=e.createDiv("heatmap-view-container")}getConfig(){let t=this.config,e=t.get("minValue"),n=t.get("maxValue"),o=e?parseFloat(e):null,s=n?parseFloat(n):null;return{dateProperty:t.get("dateProperty")||"__filename__",valueProperty:t.get("valueProperty")||"",startDate:t.get("startDate")||null,endDate:t.get("endDate")||null,colorScheme:t.get("colorScheme")||"green",weekStart:parseInt(t.get("weekStart")||"0",10),showWeekdayLabels:t.get("showWeekdayLabels")!==!1,showMonthLabels:t.get("showMonthLabels")!==!1,minValue:o!==null&&!isNaN(o)?o:null,maxValue:s!==null&&!isNaN(s)?s:null}}onDataUpdated(){this.render()}render(){this.cleanupInteractions&&(this.cleanupInteractions(),this.cleanupInteractions=null),this.containerEl.empty();let t=this.getConfig();if(!t.valueProperty){let u=N("Configure value property","Select a property to visualize in the view settings.");this.containerEl.appendChild(u);return}let e=this.data;if(!e)return;let n=e.data||[];if(n.length===0){let u=N("No data to display","No notes found in the current filter. Check your Base filters.");this.containerEl.appendChild(u);return}if(R(n,t.valueProperty,t.dateProperty)==="unsupported"){let u=N("Unsupported property type",`"${t.valueProperty}" is not a boolean or number property. Heatmap requires boolean or number properties.`);this.containerEl.appendChild(u);return}if(this.processedData=B(n,t.dateProperty,t.valueProperty),t.minValue!==null&&(this.processedData.stats.min=t.minValue),t.maxValue!==null&&(this.processedData.stats.max=t.maxValue),this.processedData.entries.size===0){let u=N("No dated notes found","No notes with valid dates were found. Check your date property setting.");this.containerEl.appendChild(u);return}let s=W(this.processedData.entries,t.startDate,t.endDate),i={colorScheme:t.colorScheme,weekStart:t.weekStart,showWeekdayLabels:t.showWeekdayLabels,showMonthLabels:t.showMonthLabels},c=j(this.processedData,s,i);this.containerEl.appendChild(c),this.cleanupInteractions=X({app:this.app,entries:this.processedData.entries,containerEl:c,plugin:this.plugin})}};var ee={showHexColorInTooltip:!1};var C=class extends b.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new I(this.app,this)),this.registerBasesView("heatmap",{name:"Heatmap",icon:"calendar-heat",factory:(t,e)=>new E(t,e,this),options:()=>[{type:"property",key:"dateProperty",displayName:"Date property",placeholder:"Use filename for daily notes"},{type:"property",key:"valueProperty",displayName:"Value property"},{type:"text",key:"startDate",displayName:"Start date",placeholder:"YYYY-MM-DD (leave empty for auto)"},{type:"text",key:"endDate",displayName:"End date",placeholder:"YYYY-MM-DD (leave empty for today)"},{type:"dropdown",key:"colorScheme",displayName:"Color scheme",default:"green",options:{green:"Green",purple:"Purple",blue:"Blue",orange:"Orange",gray:"Gray"}},{type:"dropdown",key:"weekStart",displayName:"Week starts on",default:"0",options:{0:"Sunday",1:"Monday"}},{type:"toggle",key:"showWeekdayLabels",displayName:"Show weekday labels",default:!0},{type:"toggle",key:"showMonthLabels",displayName:"Show month labels",default:!0},{type:"text",key:"minValue",displayName:"Min value",placeholder:"Auto (based on data)"},{type:"text",key:"maxValue",displayName:"Max value",placeholder:"Auto (based on data)"}]})}onunload(){}async loadSettings(){this.settings=Object.assign({},ee,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},I=class extends b.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new b.Setting(t).setName("Show hex color in tooltip").setDesc("Display the hex color code in cell tooltips on hover").addToggle(e=>e.setValue(this.plugin.settings.showHexColorInTooltip).onChange(async n=>{this.plugin.settings.showHexColorInTooltip=n,await this.plugin.saveSettings()}))}};
