/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(o,a)=>{for(var t in a)L(o,t,{get:a[t],enumerable:!0})},ae=(o,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of ee(a))!te.call(o,n)&&n!==t&&L(o,n,{get:()=>a[n],enumerable:!(e=Z(a,n))||e.enumerable});return o};var re=o=>ae(L({},"__esModule",{value:!0}),o);var ye={};ne(ye,{default:()=>C});module.exports=re(ye);var Q=require("obsidian");var q=require("obsidian");var f=require("obsidian");var oe=/^(\d{4})-(\d{2})-(\d{2})$/;function h(o){let a=oe.exec(o.trim());if(!a)return null;let t=Number(a[1]),e=Number(a[2])-1,n=Number(a[3]);if(isNaN(t)||isNaN(e)||isNaN(n))return null;let r=new Date(t,e,n);return r.setHours(0,0,0,0),r}var se=[/^(\d{4}-\d{2}-\d{2})/,/^(\d{4})\/(\d{2})\/(\d{2})/,/^(\w+ \d{1,2}, \d{4})/];function H(o){let a=o.replace(/\.md$/i,"");for(let t of se){let e=a.match(t);if(e){let n;e.length===4?n=`${e[1]}-${e[2]}-${e[3]}`:n=e[1];let r=h(n);if(r)return r;let l=new Date(n);if(!isNaN(l.getTime()))return l.setHours(0,0,0,0),l}}return null}function S(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function V(o){var t;let a=(t=h(o))!=null?t:new Date(o);return isNaN(a.getTime())?o:a.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}function x(o,a){let t=[],e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);for(n.setHours(0,0,0,0);e<=n;)t.push(S(e)),e.setDate(e.getDate()+1);return t}function M(o,a){let t=o.getDay();return a===0?t:t===0?6:t-1}function w(o,a,t){let e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);n.setHours(0,0,0,0);let r=e.getTime()-n.getTime(),l=Math.floor(r/(1e3*60*60*24)),i=M(n,t);return Math.floor((l+i)/7)+1}function I(o,a,t){var r,l;let e,n;if(t?(n=(r=h(t))!=null?r:new Date(t),isNaN(n.getTime())&&(n=new Date)):n=new Date,n.setHours(0,0,0,0),a)e=(l=h(a))!=null?l:new Date(a),isNaN(e.getTime())&&(e=new Date(n.getFullYear(),0,1));else{let i=Array.from(o.keys()).map(c=>{var s;return(s=h(c))!=null?s:new Date(c)}).filter(c=>!isNaN(c.getTime())).sort((c,s)=>c.getTime()-s.getTime());i.length>0?e=i[0]:e=new Date(n.getFullYear(),0,1)}return e.setHours(0,0,0,0),{start:e,end:n}}function P(o,a,t){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Map,r=new Date(o);r.setHours(0,0,0,0);let l=new Date(a);for(l.setHours(0,0,0,0);r<=l;){let p=r.getMonth(),d=w(r,o,t);n.has(d)||n.set(d,new Set),n.get(d).add(p),r.setDate(r.getDate()+1)}let i=[],c=w(l,o,t),s=-1,u=null;for(let p=1;p<=c;p++){let d=n.get(p);if(!d)continue;let m=Array.from(d).sort((g,b)=>g-b),y=m[m.length-1];y!==s&&(u&&(u.endColumn=p),u={name:e[y],startColumn:p,endColumn:c+1},i.push(u),s=y)}return u&&(u.endColumn=c+1),i}function O(o){let a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return o===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:a}function v(o){return o.includes(".")?o:`frontmatter.${o}`}function $(o,a){var l,i;if(a==="__filename__"||!a){let c=H(o.file.basename);return c?S(c):null}let t=v(a),e=o.getValue(t);if(e===null||e instanceof f.NullValue)return null;if(e instanceof f.DateValue){let c=e.toString(),s=(l=h(c))!=null?l:new Date(c);return isNaN(s.getTime())?null:S(s)}let n=e.toString(),r=(i=h(n))!=null?i:new Date(n);return isNaN(r.getTime())?null:S(r)}function le(o,a){let t=v(a),e=o.getValue(t);if(e===null||e instanceof f.NullValue)return{value:null,displayValue:`${a}: not set`,type:"unsupported"};if(e instanceof f.BooleanValue){let r=e.isTruthy();return{value:r?1:0,displayValue:r?"Yes":"No",type:"boolean"}}if(e instanceof f.NumberValue){let r=Number(e.toString());return isNaN(r)?{value:null,displayValue:e.toString(),type:"unsupported"}:{value:r,displayValue:String(r),type:"number"}}if(e instanceof f.StringValue){let r=e.toString(),l=parseFloat(r);if(!isNaN(l))return{value:l,displayValue:r,type:"number"};let i=r.toLowerCase();return i==="true"||i==="yes"?{value:1,displayValue:"Yes",type:"boolean"}:i==="false"||i==="no"?{value:0,displayValue:"No",type:"boolean"}:{value:null,displayValue:r,type:"unsupported"}}return{value:e.isTruthy()?1:0,displayValue:e.toString(),type:"boolean"}}function W(o,a,t){let e=new Map,n=1/0,r=-1/0,l=0,i=!1;for(let c of o){let s=$(c,a);if(!s)continue;let{value:u,displayValue:p,type:d}=le(c,t);d==="number"&&u!==null&&u!==0&&u!==1&&(i=!0),u!==null&&u>0&&(n=Math.min(n,u),r=Math.max(r,u),l++);let m=e.get(s);m?u!==null&&(m.value===null||u>m.value)&&e.set(s,{date:s,value:u,note:c.file,displayValue:p}):e.set(s,{date:s,value:u,note:c.file,displayValue:p})}return n===1/0&&(n=0),r===-1/0&&(r=1),n===r&&n>0&&(n=0),{entries:e,stats:{min:n,max:r,count:l,hasNumeric:i}}}function z(o,a,t){let e=!1,n=!1,r=!1,l=v(a);for(let i of o){if(!$(i,t))continue;let s=i.getValue(l);if(!(s===null||s instanceof f.NullValue))if(r=!0,s instanceof f.BooleanValue)e=!0;else if(s instanceof f.NumberValue){let u=Number(s.toString());if(isNaN(u))return"unsupported";u!==0&&u!==1?n=!0:e=!0}else if(s instanceof f.StringValue){let u=s.toString(),p=parseFloat(u);if(!isNaN(p))p!==0&&p!==1?n=!0:e=!0;else{let d=u.toLowerCase();if(["true","false","yes","no"].includes(d))e=!0;else return"unsupported"}}else e=!0}return r?n?"number":e?"boolean":"unsupported":"unsupported"}function A(o,a,t){return t===a?1:o<=a?0:o>=t?1:(o-a)/(t-a)}function B(o){return o?1:0}function F(o){return o<=0?0:o<=.25?1:o<=.5?2:o<=.75?3:4}function R(){return document.body.classList.contains("theme-dark")}function ie(o,a,t){let e=a.get(o);if(!e)return{type:"empty"};if(e.value===null||e.value===0)return{type:"zero",note:e.note};let n;return t.hasNumeric?n=A(e.value,t.min,t.max):n=B(e.value>0),{type:"filled",note:e.note,intensity:n}}function ce(o,a,t,e,n){let r=document.createElement("div");if(r.className="heatmap-cell",r.dataset.date=o,r.style.gridRow=String(t),r.style.gridColumn=String(e),a.type==="empty")r.classList.add("heatmap-cell--empty");else if(a.type==="zero")r.classList.add("heatmap-cell--zero"),r.dataset.notePath=a.note.path;else if(a.type==="filled"){r.classList.add("heatmap-cell--filled"),r.dataset.notePath=a.note.path,r.dataset.intensity=String(a.intensity);let l=F(a.intensity);r.classList.add(`heatmap-cell--level-${l}`)}return n&&(r.dataset.displayValue=n.displayValue),r}function ue(o,a){let t=document.createElement("div");t.className="heatmap-month-labels",t.style.setProperty("--total-weeks",String(a));for(let e of o){let n=document.createElement("span");n.className="heatmap-month-label",n.textContent=e.name,n.style.gridColumnStart=String(e.startColumn),n.style.gridColumnEnd=String(e.endColumn),t.appendChild(n)}return t}function pe(o){let a=document.createElement("div");a.className="heatmap-weekday-labels";let t=O(o),e=o===1?[0,2,4]:[1,3,5];for(let n=0;n<7;n++){let r=document.createElement("span");r.className="heatmap-weekday-label",e.includes(n)&&(r.textContent=t[n]),a.appendChild(r)}return a}function de(o){let a=document.createElement("div");a.className="heatmap-legend";let t=document.createElement("span");t.className="heatmap-legend-label",t.textContent="Less",a.appendChild(t);let e=document.createElement("div");e.className="heatmap-legend-cells";for(let r=0;r<=4;r++){let l=document.createElement("div");l.className=`heatmap-legend-cell heatmap-cell--level-${r}`,e.appendChild(l)}a.appendChild(e);let n=document.createElement("span");return n.className="heatmap-legend-label",n.textContent="More",a.appendChild(n),a}function E(o,a){let t=document.createElement("div");t.className="heatmap-empty-state";let e=document.createElement("div");e.className="heatmap-empty-state-icon",e.textContent="\u26A0",t.appendChild(e);let n=document.createElement("div");n.className="heatmap-empty-state-title",n.textContent=o,t.appendChild(n);let r=document.createElement("div");return r.className="heatmap-empty-state-description",r.textContent=a,t.appendChild(r),t}function Y(o,a,t){var T;let{entries:e,stats:n}=o,{colorScheme:r,weekStart:l,showWeekdayLabels:i,showMonthLabels:c}=t,s=x(a.start,a.end),u=P(a.start,a.end,l),p=w(a.end,a.start,l),d=document.createElement("div");d.className=`heatmap-container heatmap--${r}`,R()?d.classList.add("heatmap--dark"):d.classList.add("heatmap--light");let m=document.createElement("div");m.className="heatmap-scroll-wrapper";let y=document.createElement("div");y.className="heatmap-inner-wrapper",i&&y.classList.add("heatmap-inner-wrapper--with-labels"),c&&y.appendChild(ue(u,p));let g=document.createElement("div");g.className="heatmap-grid",i&&g.appendChild(pe(l));let b=document.createElement("div");b.className="heatmap-cells";for(let D of s){let k=(T=h(D))!=null?T:new Date(D);if(isNaN(k.getTime()))continue;let G=M(k,l),J=w(k,a.start,l),j=ie(D,e,n),K=e.get(D),X=ce(D,j,G+1,J,K);b.appendChild(X)}return g.appendChild(b),y.appendChild(g),m.appendChild(y),d.appendChild(m),d.appendChild(de(r)),d}var _=require("obsidian");function U(o){let{app:a,entries:t,containerEl:e}=o,n=[],r=s=>{let p=s.target.closest(".heatmap-cell");if(!p)return;let d=p.dataset.notePath;d&&a.workspace.openLinkText(d,"",!1)};e.addEventListener("click",r),n.push(()=>e.removeEventListener("click",r));let l=s=>{let p=s.target.closest(".heatmap-cell");if(!p)return;let d=p.dataset.date;if(!d)return;let m=me(d,t.get(d),p);(0,_.setTooltip)(p,m,{placement:"top"})};e.addEventListener("mouseover",l),n.push(()=>e.removeEventListener("mouseover",l));let i=s=>{let p=s.target.closest(".heatmap-cell");if(!(!p||!p.dataset.date)){if(s.key==="Enter"){let m=p.dataset.notePath;m&&a.workspace.openLinkText(m,"",!1)}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.key)&&(s.preventDefault(),fe(p,s.key,e))}};return e.addEventListener("keydown",i),n.push(()=>e.removeEventListener("keydown",i)),e.querySelectorAll(".heatmap-cell").forEach(s=>{s.tabIndex=0}),()=>{n.forEach(s=>s())}}function me(o,a,t){let e=V(o);if(!a)return`${e}
No note`;let n=t.dataset.displayValue||a.displayValue;return`${e}
${n}`}function fe(o,a,t){var c;let e=o.dataset.date;if(!e)return;let n=(c=h(e))!=null?c:new Date(e);if(isNaN(n.getTime()))return;let r;switch(a){case"ArrowUp":r=new Date(n),r.setDate(n.getDate()-1);break;case"ArrowDown":r=new Date(n),r.setDate(n.getDate()+1);break;case"ArrowLeft":r=new Date(n),r.setDate(n.getDate()-7);break;case"ArrowRight":r=new Date(n),r.setDate(n.getDate()+7);break;default:return}let l=he(r),i=t.querySelector(`.heatmap-cell[data-date="${l}"]`);i&&i.focus()}function he(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}var N=class extends q.BasesView{constructor(t,e){super(t);this.type="heatmap";this.cleanupInteractions=null;this.processedData=null;this.containerEl=e.createDiv("heatmap-view-container")}getConfig(){let t=this.config;return{dateProperty:t.get("dateProperty")||"__filename__",valueProperty:t.get("valueProperty")||"",startDate:t.get("startDate")||null,endDate:t.get("endDate")||null,colorScheme:t.get("colorScheme")||"green",weekStart:parseInt(t.get("weekStart")||"0",10),showWeekdayLabels:t.get("showWeekdayLabels")!==!1,showMonthLabels:t.get("showMonthLabels")!==!1}}onDataUpdated(){this.render()}render(){this.cleanupInteractions&&(this.cleanupInteractions(),this.cleanupInteractions=null),this.containerEl.empty();let t=this.getConfig();if(!t.valueProperty){let s=E("Configure value property","Select a property to visualize in the view settings.");this.containerEl.appendChild(s);return}let e=this.data;if(!e)return;let n=e.data||[];if(n.length===0){let s=E("No data to display","No notes found in the current filter. Check your Base filters.");this.containerEl.appendChild(s);return}if(z(n,t.valueProperty,t.dateProperty)==="unsupported"){let s=E("Unsupported property type",`"${t.valueProperty}" is not a boolean or number property. Heatmap requires boolean or number properties.`);this.containerEl.appendChild(s);return}if(this.processedData=W(n,t.dateProperty,t.valueProperty),this.processedData.entries.size===0){let s=E("No dated notes found","No notes with valid dates were found. Check your date property setting.");this.containerEl.appendChild(s);return}let l=I(this.processedData.entries,t.startDate,t.endDate),i={colorScheme:t.colorScheme,weekStart:t.weekStart,showWeekdayLabels:t.showWeekdayLabels,showMonthLabels:t.showMonthLabels},c=Y(this.processedData,l,i);this.containerEl.appendChild(c),this.cleanupInteractions=U({app:this.app,entries:this.processedData.entries,containerEl:c})}};var C=class extends Q.Plugin{async onload(){this.registerBasesView("heatmap",{name:"Heatmap",icon:"calendar-heat",factory:(a,t)=>new N(a,t),options:()=>[{type:"property",key:"dateProperty",displayName:"Date property",placeholder:"Use filename for daily notes"},{type:"property",key:"valueProperty",displayName:"Value property"},{type:"text",key:"startDate",displayName:"Start date",placeholder:"YYYY-MM-DD (leave empty for auto)"},{type:"text",key:"endDate",displayName:"End date",placeholder:"YYYY-MM-DD (leave empty for today)"},{type:"dropdown",key:"colorScheme",displayName:"Color scheme",default:"green",options:{green:"Green",purple:"Purple",blue:"Blue",orange:"Orange",gray:"Gray"}},{type:"dropdown",key:"weekStart",displayName:"Week starts on",default:"0",options:{0:"Sunday",1:"Monday"}},{type:"toggle",key:"showWeekdayLabels",displayName:"Show weekday labels",default:!0},{type:"toggle",key:"showMonthLabels",displayName:"Show month labels",default:!0}]})}onunload(){}};
