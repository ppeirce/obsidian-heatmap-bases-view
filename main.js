/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var ee=(o,a)=>{for(var t in a)C(o,t,{get:a[t],enumerable:!0})},te=(o,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of X(a))!Z.call(o,n)&&n!==t&&C(o,n,{get:()=>a[n],enumerable:!(e=K(a,n))||e.enumerable});return o};var ne=o=>te(C({},"__esModule",{value:!0}),o);var me={};ee(me,{default:()=>k});module.exports=ne(me);var U=require("obsidian");var _=require("obsidian");var f=require("obsidian");var ae=[/^(\d{4}-\d{2}-\d{2})/,/^(\d{4})\/(\d{2})\/(\d{2})/,/^(\w+ \d{1,2}, \d{4})/];function N(o){let a=o.replace(/\.md$/i,"");for(let t of ae){let e=a.match(t);if(e){let n;e.length===4?n=`${e[1]}-${e[2]}-${e[3]}`:n=e[1];let r=new Date(n);if(!isNaN(r.getTime()))return r}}return null}function D(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function T(o){return new Date(o).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}function V(o,a){let t=[],e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);for(n.setHours(0,0,0,0);e<=n;)t.push(D(e)),e.setDate(e.getDate()+1);return t}function L(o,a){let t=o.getDay();return a===0?t:t===0?6:t-1}function b(o,a,t){let e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);n.setHours(0,0,0,0);let r=L(n,t),s=new Date(n);s.setDate(s.getDate()-r);let i=e.getTime()-s.getTime(),d=Math.floor(i/(1e3*60*60*24));return Math.floor(d/7)+1}function x(o,a,t){let e,n;if(t?n=new Date(t):n=new Date,n.setHours(0,0,0,0),a)e=new Date(a);else{let r=Array.from(o.keys()).map(s=>new Date(s)).filter(s=>!isNaN(s.getTime())).sort((s,i)=>s.getTime()-i.getTime());r.length>0?e=r[0]:e=new Date(n.getFullYear(),0,1)}return e.setHours(0,0,0,0),{start:e,end:n}}function H(o,a,t){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Map,r=new Date(o);r.setHours(0,0,0,0);let s=new Date(a);for(s.setHours(0,0,0,0);r<=s;){let u=r.getMonth(),p=b(r,o,t);n.has(p)||n.set(p,new Set),n.get(p).add(u),r.setDate(r.getDate()+1)}let i=[],d=b(s,o,t),l=-1,c=null;for(let u=1;u<=d;u++){let p=n.get(u);if(!p)continue;let m=Array.from(p).sort((y,g)=>y-g),h=m[m.length-1];h!==l&&(c&&(c.endColumn=u),c={name:e[h],startColumn:u,endColumn:d+1},i.push(c),l=h)}return c&&(c.endColumn=d+1),i}function I(o){let a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return o===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:a}function v(o){return o.includes(".")?o:`frontmatter.${o}`}function P(o,a){if(a==="__filename__"||!a){let s=N(o.file.basename);return s?D(s):null}let t=v(a),e=o.getValue(t);if(e===null||e instanceof f.NullValue)return null;if(e instanceof f.DateValue){let s=e.toString(),i=new Date(s);return isNaN(i.getTime())?null:D(i)}let n=e.toString(),r=new Date(n);return isNaN(r.getTime())?null:D(r)}function re(o,a){let t=v(a),e=o.getValue(t);if(e===null||e instanceof f.NullValue)return{value:null,displayValue:`${a}: not set`,type:"unsupported"};if(e instanceof f.BooleanValue){let r=e.value;return{value:r?1:0,displayValue:r?"Yes":"No",type:"boolean"}}if(e instanceof f.NumberValue){let r=e.value;return{value:r,displayValue:String(r),type:"number"}}if(e instanceof f.StringValue){let r=e.value,s=parseFloat(r);if(!isNaN(s))return{value:s,displayValue:r,type:"number"};let i=r.toLowerCase();return i==="true"||i==="yes"?{value:1,displayValue:"Yes",type:"boolean"}:i==="false"||i==="no"?{value:0,displayValue:"No",type:"boolean"}:{value:null,displayValue:r,type:"unsupported"}}return{value:e.isTruthy()?1:0,displayValue:e.toString(),type:"boolean"}}function W(o,a,t){let e=new Map,n=1/0,r=-1/0,s=0,i=!1;for(let d of o){let l=P(d,a);if(!l)continue;let{value:c,displayValue:u,type:p}=re(d,t);p==="number"&&c!==null&&c!==0&&c!==1&&(i=!0),c!==null&&c>0&&(n=Math.min(n,c),r=Math.max(r,c),s++);let m=e.get(l);m?c!==null&&(m.value===null||c>m.value)&&e.set(l,{date:l,value:c,note:d.file,displayValue:u}):e.set(l,{date:l,value:c,note:d.file,displayValue:u})}return n===1/0&&(n=0),r===-1/0&&(r=1),n===r&&n>0&&(n=0),{entries:e,stats:{min:n,max:r,count:s,hasNumeric:i}}}function $(o,a,t){let e=!1,n=!1,r=!1,s=v(a);for(let i of o){if(!P(i,t))continue;let l=i.getValue(s);if(!(l===null||l instanceof f.NullValue))if(r=!0,l instanceof f.BooleanValue)e=!0;else if(l instanceof f.NumberValue){let c=l.value;c!==0&&c!==1?n=!0:e=!0}else if(l instanceof f.StringValue){let c=l.value,u=parseFloat(c);if(!isNaN(u))u!==0&&u!==1?n=!0:e=!0;else{let p=c.toLowerCase();if(["true","false","yes","no"].includes(p))e=!0;else return"unsupported"}}else e=!0}return r?n?"number":e?"boolean":"unsupported":"unsupported"}function O(o,a,t){return t===a?1:o<=a?0:o>=t?1:(o-a)/(t-a)}function z(o){return o?1:0}function A(o){return o<=0?0:o<=.25?1:o<=.5?2:o<=.75?3:4}function B(){return document.body.classList.contains("theme-dark")}function oe(o,a,t){let e=a.get(o);if(!e)return{type:"empty"};if(e.value===null||e.value===0)return{type:"zero",note:e.note};let n;return t.hasNumeric?n=O(e.value,t.min,t.max):n=z(e.value>0),{type:"filled",note:e.note,intensity:n}}function se(o,a,t,e,n){let r=document.createElement("div");if(r.className="heatmap-cell",r.dataset.date=o,r.style.gridRow=String(t),r.style.gridColumn=String(e),a.type==="empty")r.classList.add("heatmap-cell--empty");else if(a.type==="zero")r.classList.add("heatmap-cell--zero"),r.dataset.notePath=a.note.path;else if(a.type==="filled"){r.classList.add("heatmap-cell--filled"),r.dataset.notePath=a.note.path,r.dataset.intensity=String(a.intensity);let s=A(a.intensity);r.classList.add(`heatmap-cell--level-${s}`)}return n&&(r.dataset.displayValue=n.displayValue),r}function le(o,a){let t=document.createElement("div");t.className="heatmap-month-labels",t.style.setProperty("--total-weeks",String(a));for(let e of o){let n=document.createElement("span");n.className="heatmap-month-label",n.textContent=e.name,n.style.gridColumnStart=String(e.startColumn),n.style.gridColumnEnd=String(e.endColumn),t.appendChild(n)}return t}function ie(o){let a=document.createElement("div");a.className="heatmap-weekday-labels";let t=I(o),e=o===1?[0,2,4]:[1,3,5];for(let n=0;n<7;n++){let r=document.createElement("span");r.className="heatmap-weekday-label",e.includes(n)&&(r.textContent=t[n]),a.appendChild(r)}return a}function ce(o){let a=document.createElement("div");a.className="heatmap-legend";let t=document.createElement("span");t.className="heatmap-legend-label",t.textContent="Less",a.appendChild(t);let e=document.createElement("div");e.className="heatmap-legend-cells";for(let r=0;r<=4;r++){let s=document.createElement("div");s.className=`heatmap-legend-cell heatmap-cell--level-${r}`,e.appendChild(s)}a.appendChild(e);let n=document.createElement("span");return n.className="heatmap-legend-label",n.textContent="More",a.appendChild(n),a}function w(o,a){let t=document.createElement("div");t.className="heatmap-empty-state";let e=document.createElement("div");e.className="heatmap-empty-state-icon",e.textContent="\u26A0",t.appendChild(e);let n=document.createElement("div");n.className="heatmap-empty-state-title",n.textContent=o,t.appendChild(n);let r=document.createElement("div");return r.className="heatmap-empty-state-description",r.textContent=a,t.appendChild(r),t}function F(o,a,t){let{entries:e,stats:n}=o,{colorScheme:r,weekStart:s,showWeekdayLabels:i,showMonthLabels:d}=t,l=V(a.start,a.end),c=H(a.start,a.end,s),u=b(a.end,a.start,s),p=document.createElement("div");p.className=`heatmap-container heatmap--${r}`,B()?p.classList.add("heatmap--dark"):p.classList.add("heatmap--light");let m=document.createElement("div");m.className="heatmap-scroll-wrapper";let h=document.createElement("div");h.className="heatmap-inner-wrapper",i&&h.classList.add("heatmap-inner-wrapper--with-labels"),d&&h.appendChild(le(c,u));let y=document.createElement("div");y.className="heatmap-grid",i&&y.appendChild(ie(s));let g=document.createElement("div");g.className="heatmap-cells";for(let E of l){let M=new Date(E),Q=L(M,s),J=b(M,a.start,s),q=oe(E,e,n),G=e.get(E),j=se(E,q,Q+1,J,G);g.appendChild(j)}return y.appendChild(g),h.appendChild(y),m.appendChild(h),p.appendChild(m),p.appendChild(ce(r)),p}var R=require("obsidian");function Y(o){let{app:a,entries:t,containerEl:e}=o,n=[],r=l=>{let u=l.target.closest(".heatmap-cell");if(!u)return;let p=u.dataset.notePath;p&&a.workspace.openLinkText(p,"",!1)};e.addEventListener("click",r),n.push(()=>e.removeEventListener("click",r));let s=l=>{let u=l.target.closest(".heatmap-cell");if(!u)return;let p=u.dataset.date;if(!p)return;let m=ue(p,t.get(p),u);(0,R.setTooltip)(u,m,{placement:"top"})};e.addEventListener("mouseover",s),n.push(()=>e.removeEventListener("mouseover",s));let i=l=>{let u=l.target.closest(".heatmap-cell");if(!(!u||!u.dataset.date)){if(l.key==="Enter"){let m=u.dataset.notePath;m&&a.workspace.openLinkText(m,"",!1)}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(l.key)&&(l.preventDefault(),pe(u,l.key,e))}};return e.addEventListener("keydown",i),n.push(()=>e.removeEventListener("keydown",i)),e.querySelectorAll(".heatmap-cell").forEach(l=>{l.tabIndex=0}),()=>{n.forEach(l=>l())}}function ue(o,a,t){let e=T(o);if(!a)return`${e}
No note`;let n=t.dataset.displayValue||a.displayValue;return`${e}
${n}`}function pe(o,a,t){let e=o.dataset.date;if(!e)return;let n=new Date(e),r;switch(a){case"ArrowUp":r=new Date(n),r.setDate(n.getDate()-1);break;case"ArrowDown":r=new Date(n),r.setDate(n.getDate()+1);break;case"ArrowLeft":r=new Date(n),r.setDate(n.getDate()-7);break;case"ArrowRight":r=new Date(n),r.setDate(n.getDate()+7);break;default:return}let s=de(r),i=t.querySelector(`.heatmap-cell[data-date="${s}"]`);i&&i.focus()}function de(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}var S=class extends _.BasesView{constructor(t,e){super(t);this.type="heatmap";this.cleanupInteractions=null;this.processedData=null;this.containerEl=e}getConfig(){let t=this.config;return{dateProperty:t.get("dateProperty")||"__filename__",valueProperty:t.get("valueProperty")||"",startDate:t.get("startDate")||null,endDate:t.get("endDate")||null,colorScheme:t.get("colorScheme")||"green",weekStart:parseInt(t.get("weekStart")||"0",10),showWeekdayLabels:t.get("showWeekdayLabels")!==!1,showMonthLabels:t.get("showMonthLabels")!==!1}}onDataUpdated(){this.render()}render(){this.cleanupInteractions&&(this.cleanupInteractions(),this.cleanupInteractions=null),this.containerEl.empty(),this.containerEl.addClass("heatmap-view");let t=this.getConfig();if(!t.valueProperty){let l=w("Configure value property","Select a property to visualize in the view settings.");this.containerEl.appendChild(l);return}let e=this.data,n=(e==null?void 0:e.data)||[];if(n.length===0){let l=w("No data to display","No notes found in the current filter. Check your Base filters.");this.containerEl.appendChild(l);return}if($(n,t.valueProperty,t.dateProperty)==="unsupported"){let l=w("Unsupported property type",`"${t.valueProperty}" is not a boolean or number property. Heatmap requires boolean or number properties.`);this.containerEl.appendChild(l);return}if(this.processedData=W(n,t.dateProperty,t.valueProperty),this.processedData.entries.size===0){let l=w("No dated notes found","No notes with valid dates were found. Check your date property setting.");this.containerEl.appendChild(l);return}let s=x(this.processedData.entries,t.startDate,t.endDate),i={colorScheme:t.colorScheme,weekStart:t.weekStart,showWeekdayLabels:t.showWeekdayLabels,showMonthLabels:t.showMonthLabels},d=F(this.processedData,s,i);this.containerEl.appendChild(d),this.cleanupInteractions=Y({app:this.app,entries:this.processedData.entries,containerEl:d})}};var k=class extends U.Plugin{async onload(){this.registerBasesView("heatmap",{name:"Heatmap",icon:"calendar-heat",factory:(a,t)=>new S(a,t),options:()=>[{type:"property",key:"dateProperty",displayName:"Date property",placeholder:"Use filename for daily notes"},{type:"property",key:"valueProperty",displayName:"Value property"},{type:"text",key:"startDate",displayName:"Start date",placeholder:"YYYY-MM-DD (leave empty for auto)"},{type:"text",key:"endDate",displayName:"End date",placeholder:"YYYY-MM-DD (leave empty for today)"},{type:"dropdown",key:"colorScheme",displayName:"Color scheme",default:"green",options:{green:"Green",purple:"Purple",blue:"Blue",orange:"Orange",gray:"Gray"}},{type:"dropdown",key:"weekStart",displayName:"Week starts on",default:"0",options:{0:"Sunday",1:"Monday"}},{type:"toggle",key:"showWeekdayLabels",displayName:"Show weekday labels",default:!0},{type:"toggle",key:"showMonthLabels",displayName:"Show month labels",default:!0}]})}onunload(){}};
