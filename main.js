/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var ae=(o,a)=>{for(var t in a)k(o,t,{get:a[t],enumerable:!0})},re=(o,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of te(a))!ne.call(o,n)&&n!==t&&k(o,n,{get:()=>a[n],enumerable:!(e=ee(a,n))||e.enumerable});return o};var oe=o=>re(k({},"__esModule",{value:!0}),o);var ge={};ae(ge,{default:()=>v});module.exports=oe(ge);var G=require("obsidian");var U=require("obsidian");var y=require("obsidian");var se=/^(\d{4})-(\d{2})-(\d{2})$/;function h(o){let a=se.exec(o.trim());if(!a)return null;let t=Number(a[1]),e=Number(a[2])-1,n=Number(a[3]);if(isNaN(t)||isNaN(e)||isNaN(n))return null;let r=new Date(t,e,n);return r.setHours(0,0,0,0),r}var le=[/^(\d{4}-\d{2}-\d{2})/,/^(\d{4})\/(\d{2})\/(\d{2})/,/^(\w+ \d{1,2}, \d{4})/];function H(o){let a=o.replace(/\.md$/i,"");for(let t of le){let e=a.match(t);if(e){let n;e.length===4?n=`${e[1]}-${e[2]}-${e[3]}`:n=e[1];let r=h(n);if(r)return r;let l=new Date(n);if(!isNaN(l.getTime()))return l.setHours(0,0,0,0),l}}return null}function C(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function x(o){var t;let a=(t=h(o))!=null?t:new Date(o);return isNaN(a.getTime())?o:a.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}function I(o,a){let t=[],e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);for(n.setHours(0,0,0,0);e<=n;)t.push(C(e)),e.setDate(e.getDate()+1);return t}function M(o,a){let t=o.getDay();return a===0?t:t===0?6:t-1}function S(o,a,t){let e=new Date(o);e.setHours(0,0,0,0);let n=new Date(a);n.setHours(0,0,0,0);let r=e.getTime()-n.getTime(),l=Math.floor(r/(1e3*60*60*24)),i=M(n,t);return Math.floor((l+i)/7)+1}function P(o,a,t){var r,l;let e,n;if(t?(n=(r=h(t))!=null?r:new Date(t),isNaN(n.getTime())&&(n=new Date)):n=new Date,n.setHours(0,0,0,0),a)e=(l=h(a))!=null?l:new Date(a),isNaN(e.getTime())&&(e=new Date(n.getFullYear(),0,1));else{let i=Array.from(o.keys()).map(u=>{var s;return(s=h(u))!=null?s:new Date(u)}).filter(u=>!isNaN(u.getTime())).sort((u,s)=>u.getTime()-s.getTime());i.length>0?e=i[0]:e=new Date(n.getFullYear(),0,1)}return e.setHours(0,0,0,0),{start:e,end:n}}function O(o,a,t){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Map,r=new Date(o);r.setHours(0,0,0,0);let l=new Date(a);for(l.setHours(0,0,0,0);r<=l;){let p=r.getMonth(),d=S(r,o,t);n.has(d)||n.set(d,new Set),n.get(d).add(p),r.setDate(r.getDate()+1)}let i=[],u=S(l,o,t),s=-1,c=null;for(let p=1;p<=u;p++){let d=n.get(p);if(!d)continue;let f=Array.from(d).sort((b,D)=>b-D),g=f[f.length-1];g!==s&&(c&&(c.endColumn=p),c={name:e[g],startColumn:p,endColumn:u+1},i.push(c),s=g)}return c&&(c.endColumn=u+1),i}function R(o){let a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return o===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:a}function T(o){return o.includes(".")?o:`frontmatter.${o}`}function A(o,a){var l,i;if(a==="__filename__"||!a){let u=H(o.file.basename);return u?C(u):null}let t=T(a),e=o.getValue(t);if(e===null||e instanceof y.NullValue)return null;if(e instanceof y.DateValue){let u=e.toString(),s=(l=h(u))!=null?l:new Date(u);return isNaN(s.getTime())?null:C(s)}let n=e.toString(),r=(i=h(n))!=null?i:new Date(n);return isNaN(r.getTime())?null:C(r)}function ie(o,a){let t=T(a),e=o.getValue(t);if(e===null||e instanceof y.NullValue)return{value:null,displayValue:`${a}: not set`,type:"unsupported"};if(e instanceof y.BooleanValue){let r=e.isTruthy();return{value:r?1:0,displayValue:r?"Yes":"No",type:"boolean"}}if(e instanceof y.NumberValue){let r=Number(e.toString());return isNaN(r)?{value:null,displayValue:e.toString(),type:"unsupported"}:{value:r,displayValue:String(r),type:"number"}}if(e instanceof y.StringValue){let r=e.toString(),l=parseFloat(r);if(!isNaN(l))return{value:l,displayValue:r,type:"number"};let i=r.toLowerCase();return i==="true"||i==="yes"?{value:1,displayValue:"Yes",type:"boolean"}:i==="false"||i==="no"?{value:0,displayValue:"No",type:"boolean"}:{value:null,displayValue:r,type:"unsupported"}}return{value:e.isTruthy()?1:0,displayValue:e.toString(),type:"boolean"}}function B(o,a,t){let e=new Map,n=1/0,r=-1/0,l=0,i=!1;for(let u of o){let s=A(u,a);if(!s)continue;let{value:c,displayValue:p,type:d}=ie(u,t);d==="number"&&c!==null&&c!==0&&c!==1&&(i=!0),c!==null&&c>0&&(n=Math.min(n,c),r=Math.max(r,c),l++);let f=e.get(s);f?c!==null&&(f.value===null||c>f.value)&&e.set(s,{date:s,value:c,note:u.file,displayValue:p}):e.set(s,{date:s,value:c,note:u.file,displayValue:p})}return n===1/0&&(n=0),r===-1/0&&(r=1),n===r&&n>0&&(n=0),{entries:e,stats:{min:n,max:r,count:l,hasNumeric:i}}}function $(o,a,t){let e=!1,n=!1,r=!1,l=T(a);for(let i of o){if(!A(i,t))continue;let s=i.getValue(l);if(!(s===null||s instanceof y.NullValue))if(r=!0,s instanceof y.BooleanValue)e=!0;else if(s instanceof y.NumberValue){let c=Number(s.toString());if(isNaN(c))return"unsupported";c!==0&&c!==1?n=!0:e=!0}else if(s instanceof y.StringValue){let c=s.toString(),p=parseFloat(c);if(!isNaN(p))p!==0&&p!==1?n=!0:e=!0;else{let d=c.toLowerCase();if(["true","false","yes","no"].includes(d))e=!0;else return"unsupported"}}else e=!0}return r?n?"number":e?"boolean":"unsupported":"unsupported"}function W(o,a,t){return t===a?1:o<=a?0:o>=t?1:(o-a)/(t-a)}function q(o){return o?1:0}function Q(o){return o<=0?0:o<=.25?1:o<=.5?2:o<=.75?3:4}function z(){return document.body.classList.contains("theme-dark")}function ce(o,a,t){let e=a.get(o);if(!e)return{type:"empty"};if(e.value===null||e.value===0)return{type:"zero",note:e.note};let n;return t.hasNumeric?n=W(e.value,t.min,t.max):n=q(e.value>0),{type:"filled",note:e.note,intensity:n}}function ue(o,a,t,e,n){let r=document.createElement("div");if(r.className="heatmap-cell",r.dataset.date=o,r.style.gridRow=String(t),r.style.gridColumn=String(e),a.type==="empty")r.classList.add("heatmap-cell--empty");else if(a.type==="zero")r.classList.add("heatmap-cell--zero"),r.dataset.notePath=a.note.path;else if(a.type==="filled"){r.classList.add("heatmap-cell--filled"),r.dataset.notePath=a.note.path,r.dataset.intensity=String(a.intensity);let l=Q(a.intensity);r.classList.add(`heatmap-cell--level-${l}`)}return n&&(r.dataset.displayValue=n.displayValue),r}function pe(o,a){let t=document.createElement("div");t.className="heatmap-month-labels",t.style.setProperty("--total-weeks",String(a));for(let e of o){let n=document.createElement("span");n.className="heatmap-month-label",n.textContent=e.name,n.style.gridColumnStart=String(e.startColumn),n.style.gridColumnEnd=String(e.endColumn),t.appendChild(n)}return t}function de(o){let a=document.createElement("div");a.className="heatmap-weekday-labels";let t=R(o),e=o===1?[0,2,4]:[1,3,5];for(let n=0;n<7;n++){let r=document.createElement("span");r.className="heatmap-weekday-label",e.includes(n)&&(r.textContent=t[n]),a.appendChild(r)}return a}function me(o){let a=document.createElement("div");a.className="heatmap-legend";let t=document.createElement("span");t.className="heatmap-legend-label",t.textContent="Less",a.appendChild(t);let e=document.createElement("div");e.className="heatmap-legend-cells";for(let r=0;r<=4;r++){let l=document.createElement("div");l.className=`heatmap-legend-cell heatmap-cell--level-${r}`,e.appendChild(l)}a.appendChild(e);let n=document.createElement("span");return n.className="heatmap-legend-label",n.textContent="More",a.appendChild(n),a}function w(o,a){let t=document.createElement("div");t.className="heatmap-empty-state";let e=document.createElement("div");e.className="heatmap-empty-state-icon",e.textContent="\u26A0",t.appendChild(e);let n=document.createElement("div");n.className="heatmap-empty-state-title",n.textContent=o,t.appendChild(n);let r=document.createElement("div");return r.className="heatmap-empty-state-description",r.textContent=a,t.appendChild(r),t}function F(o,a,t){var V;let{entries:e,stats:n}=o,{colorScheme:r,weekStart:l,showWeekdayLabels:i,showMonthLabels:u}=t,s=I(a.start,a.end),c=O(a.start,a.end,l),p=S(a.end,a.start,l),d=document.createElement("div");d.className=`heatmap-container heatmap--${r}`,z()?d.classList.add("heatmap--dark"):d.classList.add("heatmap--light");let f=document.createElement("div");f.className="heatmap-scroll-wrapper";let g=document.createElement("div");g.className="heatmap-inner-wrapper",i&&g.classList.add("heatmap-inner-wrapper--with-labels"),u&&g.appendChild(pe(c,p));let b=document.createElement("div");b.className="heatmap-grid",i&&b.appendChild(de(l));let D=document.createElement("div");D.className="heatmap-cells";for(let E of s){let L=(V=h(E))!=null?V:new Date(E);if(isNaN(L.getTime()))continue;let j=M(L,l),J=S(L,a.start,l),K=ce(E,e,n),X=e.get(E),Z=ue(E,K,j+1,J,X);D.appendChild(Z)}return b.appendChild(D),g.appendChild(b),f.appendChild(g),d.appendChild(f),d.appendChild(me(r)),d}var _=require("obsidian");function Y(o){let{app:a,entries:t,containerEl:e}=o,n=[],r=s=>{let p=s.target.closest(".heatmap-cell");if(!p)return;let d=p.dataset.notePath;d&&a.workspace.openLinkText(d,"",!1)};e.addEventListener("click",r),n.push(()=>e.removeEventListener("click",r));let l=s=>{let p=s.target.closest(".heatmap-cell");if(!p)return;let d=p.dataset.date;if(!d)return;let f=fe(d,t.get(d),p);(0,_.setTooltip)(p,f,{placement:"top"})};e.addEventListener("mouseover",l),n.push(()=>e.removeEventListener("mouseover",l));let i=s=>{let p=s.target.closest(".heatmap-cell");if(!(!p||!p.dataset.date)){if(s.key==="Enter"){let f=p.dataset.notePath;f&&a.workspace.openLinkText(f,"",!1)}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.key)&&(s.preventDefault(),ye(p,s.key,e))}};return e.addEventListener("keydown",i),n.push(()=>e.removeEventListener("keydown",i)),e.querySelectorAll(".heatmap-cell").forEach(s=>{s.tabIndex=0}),()=>{n.forEach(s=>s())}}function fe(o,a,t){let e=x(o);if(!a)return`${e}
No note`;let n=t.dataset.displayValue||a.displayValue;return`${e}
${n}`}function ye(o,a,t){var u;let e=o.dataset.date;if(!e)return;let n=(u=h(e))!=null?u:new Date(e);if(isNaN(n.getTime()))return;let r;switch(a){case"ArrowUp":r=new Date(n),r.setDate(n.getDate()-1);break;case"ArrowDown":r=new Date(n),r.setDate(n.getDate()+1);break;case"ArrowLeft":r=new Date(n),r.setDate(n.getDate()-7);break;case"ArrowRight":r=new Date(n),r.setDate(n.getDate()+7);break;default:return}let l=he(r),i=t.querySelector(`.heatmap-cell[data-date="${l}"]`);i&&i.focus()}function he(o){let a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function m(...o){typeof window=="undefined"||!window.HEATMAP_DEBUG||console.log("[HeatmapView]",...o)}var N=class extends U.BasesView{constructor(t,e){var n;super(t);this.type="heatmap";this.isViewVisible=!1;this.cleanupInteractions=null;this.processedData=null;this.initialQueryRequested=!1;if(this.controllerRef=t,this.containerEl=e,m("Constructed HeatmapView"),window.HEATMAP_DEBUG)try{let r=(n=Object.getPrototypeOf(t))!=null?n:{};m("QueryController prototype methods",Object.getOwnPropertyNames(r))}catch(r){m("Failed to inspect controller prototype",r)}this.requestInitialQuery()}onload(){super.onload(),m("HeatmapView onload"),this.isViewVisible=!0,this.processedData||this.requestInitialQuery()}onunload(){super.onunload(),m("HeatmapView onunload"),this.isViewVisible=!1}getConfig(){let t=this.config;return{dateProperty:t.get("dateProperty")||"__filename__",valueProperty:t.get("valueProperty")||"",startDate:t.get("startDate")||null,endDate:t.get("endDate")||null,colorScheme:t.get("colorScheme")||"green",weekStart:parseInt(t.get("weekStart")||"0",10),showWeekdayLabels:t.get("showWeekdayLabels")!==!1,showMonthLabels:t.get("showMonthLabels")!==!1}}onDataUpdated(){var t,e,n;m("onDataUpdated called",{entryCount:(n=(e=(t=this.data)==null?void 0:t.data)==null?void 0:e.length)!=null?n:0}),this.initialQueryRequested||this.requestInitialQuery(),this.render()}render(){m("render start"),this.cleanupInteractions&&(this.cleanupInteractions(),this.cleanupInteractions=null),this.containerEl.empty(),this.containerEl.addClass("heatmap-view");let t=this.getConfig();if(!t.valueProperty){m("render aborted: missing valueProperty");let s=w("Configure value property","Select a property to visualize in the view settings.");this.containerEl.appendChild(s);return}let e=this.data,n=(e==null?void 0:e.data)||[];if(n.length===0){if(this.requestInitialQuery()){m("render waiting for query results");let c=w("Loading data\u2026","Fetching notes for this Base.");this.containerEl.appendChild(c);return}m("render aborted: no entries from query");let s=w("No data to display","No notes found in the current filter. Check your Base filters.");this.containerEl.appendChild(s);return}if($(n,t.valueProperty,t.dateProperty)==="unsupported"){m("render aborted: unsupported property type");let s=w("Unsupported property type",`"${t.valueProperty}" is not a boolean or number property. Heatmap requires boolean or number properties.`);this.containerEl.appendChild(s);return}if(this.processedData=B(n,t.dateProperty,t.valueProperty),this.processedData.entries.size===0){m("render aborted: no dated entries after processing");let s=w("No dated notes found","No notes with valid dates were found. Check your date property setting.");this.containerEl.appendChild(s);return}let l=P(this.processedData.entries,t.startDate,t.endDate),i={colorScheme:t.colorScheme,weekStart:t.weekStart,showWeekdayLabels:t.showWeekdayLabels,showMonthLabels:t.showMonthLabels};m("render proceeding",{entryCount:this.processedData.entries.size,stats:this.processedData.stats,viewConfig:t});let u=F(this.processedData,l,i);this.containerEl.appendChild(u),this.cleanupInteractions=Y({app:this.app,entries:this.processedData.entries,containerEl:u})}requestInitialQuery(){if(this.initialQueryRequested||!this.isViewVisible)return!1;this.initialQueryRequested=!0;try{if(typeof this.controllerRef.runQuery=="function")this.controllerRef.runQuery(),m("Requested initial Bases query via runQuery()");else if(typeof this.controllerRef.notifyView=="function")this.controllerRef.notifyView(this.type,"request-query"),m("Requested initial Bases query via notifyView()");else return m("No supported method to request Bases query"),this.initialQueryRequested=!1,!1}catch(t){this.initialQueryRequested=!1,m("Failed to run initial query",t)}return!0}};var v=class extends G.Plugin{async onload(){this.registerBasesView("heatmap",{name:"Heatmap",icon:"calendar-heat",factory:(a,t)=>new N(a,t),options:()=>[{type:"property",key:"dateProperty",displayName:"Date property",placeholder:"Use filename for daily notes"},{type:"property",key:"valueProperty",displayName:"Value property"},{type:"text",key:"startDate",displayName:"Start date",placeholder:"YYYY-MM-DD (leave empty for auto)"},{type:"text",key:"endDate",displayName:"End date",placeholder:"YYYY-MM-DD (leave empty for today)"},{type:"dropdown",key:"colorScheme",displayName:"Color scheme",default:"green",options:{green:"Green",purple:"Purple",blue:"Blue",orange:"Orange",gray:"Gray"}},{type:"dropdown",key:"weekStart",displayName:"Week starts on",default:"0",options:{0:"Sunday",1:"Monday"}},{type:"toggle",key:"showWeekdayLabels",displayName:"Show weekday labels",default:!0},{type:"toggle",key:"showMonthLabels",displayName:"Show month labels",default:!0}]})}onunload(){}};
