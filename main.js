/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var le=(r,n)=>{for(var t in n)M(r,t,{get:n[t],enumerable:!0})},ie=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of oe(n))!se.call(r,a)&&a!==t&&M(r,a,{get:()=>n[a],enumerable:!(e=re(n,a))||e.enumerable});return r};var ce=r=>ie(M({},"__esModule",{value:!0}),r);var ke={};le(ke,{default:()=>k});module.exports=ce(ke);var X=require("obsidian");var K=require("obsidian");var f=require("obsidian");var ue=/^(\d{4})-(\d{2})-(\d{2})$/;function g(r){let n=ue.exec(r.trim());if(!n)return null;let t=Number(n[1]),e=Number(n[2])-1,a=Number(n[3]);if(isNaN(t)||isNaN(e)||isNaN(a))return null;let o=new Date(t,e,a);return o.setHours(0,0,0,0),o}var pe=[/^(\d{4}-\d{2}-\d{2})/,/^(\d{4})\/(\d{2})\/(\d{2})/,/^(\w+ \d{1,2}, \d{4})/];function P(r){let n=r.replace(/\.md$/i,"");for(let t of pe){let e=n.match(t);if(e){let a;e.length===4?a=`${e[1]}-${e[2]}-${e[3]}`:a=e[1];let o=g(a);if(o)return o;let s=new Date(a);if(!isNaN(s.getTime()))return s.setHours(0,0,0,0),s}}return null}function S(r){let n=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),e=String(r.getDate()).padStart(2,"0");return`${n}-${t}-${e}`}function $(r){var t;let n=(t=g(r))!=null?t:new Date(r);return isNaN(n.getTime())?r:n.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}function O(r,n){let t=[],e=new Date(r);e.setHours(0,0,0,0);let a=new Date(n);for(a.setHours(0,0,0,0);e<=a;)t.push(S(e)),e.setDate(e.getDate()+1);return t}function L(r,n){let t=r.getDay();return n===0?t:t===0?6:t-1}function w(r,n,t){let e=new Date(r);e.setHours(0,0,0,0);let a=new Date(n);a.setHours(0,0,0,0);let o=e.getTime()-a.getTime(),s=Math.floor(o/(1e3*60*60*24)),i=L(a,t);return Math.floor((s+i)/7)+1}function W(r,n,t){var o,s;let e,a;if(t?(a=(o=g(t))!=null?o:new Date(t),isNaN(a.getTime())&&(a=new Date)):a=new Date,a.setHours(0,0,0,0),n)e=(s=g(n))!=null?s:new Date(n),isNaN(e.getTime())&&(e=new Date(a.getFullYear(),0,1));else{let i=Array.from(r.keys()).map(c=>{var l;return(l=g(c))!=null?l:new Date(c)}).filter(c=>!isNaN(c.getTime())).sort((c,l)=>c.getTime()-l.getTime());i.length>0?e=i[0]:e=new Date(a.getFullYear(),0,1)}return e.setHours(0,0,0,0),{start:e,end:a}}function A(r,n,t){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=new Map,o=new Date(r);o.setHours(0,0,0,0);let s=new Date(n);for(s.setHours(0,0,0,0);o<=s;){let p=o.getMonth(),m=w(o,r,t);a.has(m)||a.set(m,new Set),a.get(m).add(p),o.setDate(o.getDate()+1)}let i=[],c=w(s,r,t),l=-1,u=null;for(let p=1;p<=c;p++){let m=a.get(p);if(!m)continue;let d=Array.from(m).sort((y,b)=>y-b),h=d[d.length-1];h!==l&&(u&&(u.endColumn=p),u={name:e[h],startColumn:p,endColumn:c+1},i.push(u),l=h)}return u&&(u.endColumn=c+1),i}function z(r){let n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return r===1?["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:n}function T(r){return r.includes(".")?r:`frontmatter.${r}`}function F(r,n){var s,i;if(n==="__filename__"||!n){let c=P(r.file.basename);return c?S(c):null}let t=T(n),e=r.getValue(t);if(e===null||e instanceof f.NullValue)return null;if(e instanceof f.DateValue){let c=e.toString(),l=(s=g(c))!=null?s:new Date(c);return isNaN(l.getTime())?null:S(l)}let a=e.toString(),o=(i=g(a))!=null?i:new Date(a);return isNaN(o.getTime())?null:S(o)}function me(r,n){let t=T(n),e=r.getValue(t);if(e===null||e instanceof f.NullValue)return{value:null,displayValue:`${n}: not set`,type:"unsupported"};if(e instanceof f.BooleanValue){let o=e.isTruthy();return{value:o?1:0,displayValue:o?"Yes":"No",type:"boolean"}}if(e instanceof f.NumberValue){let o=Number(e.toString());return isNaN(o)?{value:null,displayValue:e.toString(),type:"unsupported"}:{value:o,displayValue:String(o),type:"number"}}if(e instanceof f.StringValue){let o=e.toString(),s=parseFloat(o);if(!isNaN(s))return{value:s,displayValue:o,type:"number"};let i=o.toLowerCase();return i==="true"||i==="yes"?{value:1,displayValue:"Yes",type:"boolean"}:i==="false"||i==="no"?{value:0,displayValue:"No",type:"boolean"}:{value:null,displayValue:o,type:"unsupported"}}return{value:e.isTruthy()?1:0,displayValue:e.toString(),type:"boolean"}}function _(r,n,t){let e=new Map,a=1/0,o=-1/0,s=0,i=!1;for(let c of r){let l=F(c,n);if(!l)continue;let{value:u,displayValue:p,type:m}=me(c,t);m==="number"&&u!==null&&u!==0&&u!==1&&(i=!0),u!==null&&(a=Math.min(a,u),o=Math.max(o,u),s++);let d=e.get(l);d?u!==null&&(d.value===null||u>d.value)&&e.set(l,{date:l,value:u,note:c.file,displayValue:p}):e.set(l,{date:l,value:u,note:c.file,displayValue:p})}return a===1/0&&(a=0),o===-1/0&&(o=1),a===o&&a>0&&(a=0),{entries:e,stats:{min:a,max:o,count:s,hasNumeric:i}}}function B(r,n,t){let e=!1,a=!1,o=!1,s=T(n);for(let i of r){if(!F(i,t))continue;let l=i.getValue(s);if(!(l===null||l instanceof f.NullValue))if(o=!0,l instanceof f.BooleanValue)e=!0;else if(l instanceof f.NumberValue){let u=Number(l.toString());if(isNaN(u))return"unsupported";u!==0&&u!==1?a=!0:e=!0}else if(l instanceof f.StringValue){let u=l.toString(),p=parseFloat(u);if(!isNaN(p))p!==0&&p!==1?a=!0:e=!0;else{let m=u.toLowerCase();if(["true","false","yes","no"].includes(m))e=!0;else return"unsupported"}}else e=!0}return o?a?"number":e?"boolean":"unsupported":"unsupported"}var R={green:{dark:{zero:"#161b22",max:"#39d353"},light:{zero:"#ebedf0",max:"#216e39"}},purple:{dark:{zero:"#1a1523",max:"#a78bfa"},light:{zero:"#ebedf0",max:"#5b21b6"}},blue:{dark:{zero:"#161b22",max:"#38bdf8"},light:{zero:"#ebedf0",max:"#0284c7"}},orange:{dark:{zero:"#1c1917",max:"#fb923c"},light:{zero:"#ebedf0",max:"#ea580c"}},gray:{dark:{zero:"#161b22",max:"#adbac7"},light:{zero:"#ebedf0",max:"#444c56"}}};function Y(r){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:{r:0,g:0,b:0}}function de(r,n,t){let e=a=>Math.max(0,Math.min(255,Math.round(a))).toString(16).padStart(2,"0");return`#${e(r)}${e(n)}${e(t)}`}function V(r){return r<=.0031308?r*12.92:1.055*Math.pow(r,1/2.4)-.055}function v(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function U(r,n,t){let e=v(r/255),a=v(n/255),o=v(t/255),s=.4122214708*e+.5363325363*a+.0514459929*o,i=.2119034982*e+.6806995451*a+.1073969566*o,c=.0883024619*e+.2817188376*a+.6299787005*o,l=Math.cbrt(s),u=Math.cbrt(i),p=Math.cbrt(c);return{L:.2104542553*l+.793617785*u-.0040720468*p,a:1.9779984951*l-2.428592205*u+.4505937099*p,b:.0259040371*l+.7827717662*u-.808675766*p}}function fe(r,n,t){let e=r+.3963377774*n+.2158037573*t,a=r-.1055613458*n-.0638541728*t,o=r-.0894841775*n-1.291485548*t,s=e*e*e,i=a*a*a,c=o*o*o,l=4.0767416621*s-3.3077115913*i+.2309699292*c,u=-1.2684380046*s+2.6097574011*i-.3413193965*c,p=-.0041960863*s-.7034186147*i+1.707614701*c;return{r:Math.round(V(l)*255),g:Math.round(V(u)*255),b:Math.round(V(p)*255)}}function ge(r,n,t){let e=Y(r),a=Y(n),o=U(e.r,e.g,e.b),s=U(a.r,a.g,a.b),i=o.L+(s.L-o.L)*t,c=o.a+(s.a-o.a)*t,l=o.b+(s.b-o.b)*t,u=fe(i,c,l);return de(u.r,u.g,u.b)}function q(r,n,t){return t===n?1:r<=n?0:r>=t?1:(r-n)/(t-n)}function Q(r){return r?1:0}function H(r,n,t){let e=t?R[n].dark:R[n].light;if(r<=0)return e.zero;let a=Math.max(0,Math.min(1,r));return ge(e.zero,e.max,a)}function E(){return document.body.classList.contains("theme-dark")}function he(r,n,t){let e=n.get(r);if(!e)return{type:"empty"};if(e.value===null)return{type:"zero",note:e.note};let a;return t.hasNumeric?a=q(e.value,t.min,t.max):a=Q(e.value>0),{type:"filled",note:e.note,intensity:a}}function ye(r,n,t,e,a,o){let s=document.createElement("div");s.className="heatmap-cell",s.dataset.date=r,s.style.gridRow=String(t),s.style.gridColumn=String(e);let i=E();return n.type==="empty"?s.classList.add("heatmap-cell--empty"):n.type==="zero"?(s.classList.add("heatmap-cell--zero"),s.dataset.notePath=n.note.path):n.type==="filled"&&(s.classList.add("heatmap-cell--filled"),s.dataset.notePath=n.note.path,s.dataset.intensity=String(n.intensity),s.style.backgroundColor=H(n.intensity,o,i)),a&&(s.dataset.displayValue=a.displayValue),s}function be(r,n){let t=document.createElement("div");t.className="heatmap-month-labels",t.style.setProperty("--total-weeks",String(n));for(let e of r){let a=document.createElement("span");a.className="heatmap-month-label",a.textContent=e.name,a.style.gridColumnStart=String(e.startColumn),a.style.gridColumnEnd=String(e.endColumn),t.appendChild(a)}return t}function De(r){let n=document.createElement("div");n.className="heatmap-weekday-labels";let t=z(r),e=r===1?[0,2,4]:[1,3,5];for(let a=0;a<7;a++){let o=document.createElement("span");o.className="heatmap-weekday-label",e.includes(a)&&(o.textContent=t[a]),n.appendChild(o)}return n}function we(r){let n=document.createElement("div");n.className="heatmap-legend";let t=document.createElement("span");t.className="heatmap-legend-label",t.textContent="Less",n.appendChild(t);let e=document.createElement("div");e.className="heatmap-legend-cells";let a=E(),o=[0,.25,.5,.75,1];for(let i of o){let c=document.createElement("div");c.className="heatmap-legend-cell",c.style.backgroundColor=H(i,r,a),e.appendChild(c)}n.appendChild(e);let s=document.createElement("span");return s.className="heatmap-legend-label",s.textContent="More",n.appendChild(s),n}function N(r,n){let t=document.createElement("div");t.className="heatmap-empty-state";let e=document.createElement("div");e.className="heatmap-empty-state-icon",e.textContent="\u26A0",t.appendChild(e);let a=document.createElement("div");a.className="heatmap-empty-state-title",a.textContent=r,t.appendChild(a);let o=document.createElement("div");return o.className="heatmap-empty-state-description",o.textContent=n,t.appendChild(o),t}function G(r,n,t){var I;let{entries:e,stats:a}=r,{colorScheme:o,weekStart:s,showWeekdayLabels:i,showMonthLabels:c}=t,l=O(n.start,n.end),u=A(n.start,n.end,s),p=w(n.end,n.start,s),m=document.createElement("div");m.className=`heatmap-container heatmap--${o}`,E()?m.classList.add("heatmap--dark"):m.classList.add("heatmap--light");let d=document.createElement("div");d.className="heatmap-scroll-wrapper";let h=document.createElement("div");h.className="heatmap-inner-wrapper",i&&h.classList.add("heatmap-inner-wrapper--with-labels"),c&&h.appendChild(be(u,p));let y=document.createElement("div");y.className="heatmap-grid",i&&y.appendChild(De(s));let b=document.createElement("div");b.className="heatmap-cells";for(let D of l){let x=(I=g(D))!=null?I:new Date(D);if(isNaN(x.getTime()))continue;let Z=L(x,s),ee=w(x,n.start,s),te=he(D,e,a),ne=e.get(D),ae=ye(D,te,Z+1,ee,ne,o);b.appendChild(ae)}return y.appendChild(b),h.appendChild(y),d.appendChild(h),m.appendChild(d),m.appendChild(we(o)),m}var J=require("obsidian");function j(r){let{app:n,entries:t,containerEl:e}=r,a=[],o=l=>{let p=l.target.closest(".heatmap-cell");if(!p)return;let m=p.dataset.notePath;m&&n.workspace.openLinkText(m,"",!1)};e.addEventListener("click",o),a.push(()=>e.removeEventListener("click",o));let s=l=>{let p=l.target.closest(".heatmap-cell");if(!p)return;let m=p.dataset.date;if(!m)return;let d=Se(m,t.get(m),p);(0,J.setTooltip)(p,d,{placement:"top"})};e.addEventListener("mouseover",s),a.push(()=>e.removeEventListener("mouseover",s));let i=l=>{let p=l.target.closest(".heatmap-cell");if(!(!p||!p.dataset.date)){if(l.key==="Enter"){let d=p.dataset.notePath;d&&n.workspace.openLinkText(d,"",!1)}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(l.key)&&(l.preventDefault(),Ee(p,l.key,e))}};return e.addEventListener("keydown",i),a.push(()=>e.removeEventListener("keydown",i)),e.querySelectorAll(".heatmap-cell").forEach(l=>{l.tabIndex=0}),()=>{a.forEach(l=>l())}}function Se(r,n,t){let e=$(r);if(!n)return`${e}
No note`;let a=t.dataset.displayValue||n.displayValue,o=t.style.backgroundColor?Ne(t.style.backgroundColor):"",s=o?`
${o}`:"";return`${e}
${a}${s}`}function Ne(r){if(r.startsWith("#"))return r;let n=r.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!n)return r;let t=parseInt(n[1],10),e=parseInt(n[2],10),a=parseInt(n[3],10),o=s=>s.toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(a)}`}function Ee(r,n,t){var c;let e=r.dataset.date;if(!e)return;let a=(c=g(e))!=null?c:new Date(e);if(isNaN(a.getTime()))return;let o;switch(n){case"ArrowUp":o=new Date(a),o.setDate(a.getDate()-1);break;case"ArrowDown":o=new Date(a),o.setDate(a.getDate()+1);break;case"ArrowLeft":o=new Date(a),o.setDate(a.getDate()-7);break;case"ArrowRight":o=new Date(a),o.setDate(a.getDate()+7);break;default:return}let s=Ce(o),i=t.querySelector(`.heatmap-cell[data-date="${s}"]`);i&&i.focus()}function Ce(r){let n=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),e=String(r.getDate()).padStart(2,"0");return`${n}-${t}-${e}`}var C=class extends K.BasesView{constructor(t,e){super(t);this.type="heatmap";this.cleanupInteractions=null;this.processedData=null;this.containerEl=e.createDiv("heatmap-view-container")}getConfig(){let t=this.config,e=t.get("minValue"),a=t.get("maxValue"),o=e?parseFloat(e):null,s=a?parseFloat(a):null;return{dateProperty:t.get("dateProperty")||"__filename__",valueProperty:t.get("valueProperty")||"",startDate:t.get("startDate")||null,endDate:t.get("endDate")||null,colorScheme:t.get("colorScheme")||"green",weekStart:parseInt(t.get("weekStart")||"0",10),showWeekdayLabels:t.get("showWeekdayLabels")!==!1,showMonthLabels:t.get("showMonthLabels")!==!1,minValue:o!==null&&!isNaN(o)?o:null,maxValue:s!==null&&!isNaN(s)?s:null}}onDataUpdated(){this.render()}render(){this.cleanupInteractions&&(this.cleanupInteractions(),this.cleanupInteractions=null),this.containerEl.empty();let t=this.getConfig();if(!t.valueProperty){let l=N("Configure value property","Select a property to visualize in the view settings.");this.containerEl.appendChild(l);return}let e=this.data;if(!e)return;let a=e.data||[];if(a.length===0){let l=N("No data to display","No notes found in the current filter. Check your Base filters.");this.containerEl.appendChild(l);return}if(B(a,t.valueProperty,t.dateProperty)==="unsupported"){let l=N("Unsupported property type",`"${t.valueProperty}" is not a boolean or number property. Heatmap requires boolean or number properties.`);this.containerEl.appendChild(l);return}if(this.processedData=_(a,t.dateProperty,t.valueProperty),t.minValue!==null&&(this.processedData.stats.min=t.minValue),t.maxValue!==null&&(this.processedData.stats.max=t.maxValue),this.processedData.entries.size===0){let l=N("No dated notes found","No notes with valid dates were found. Check your date property setting.");this.containerEl.appendChild(l);return}let s=W(this.processedData.entries,t.startDate,t.endDate),i={colorScheme:t.colorScheme,weekStart:t.weekStart,showWeekdayLabels:t.showWeekdayLabels,showMonthLabels:t.showMonthLabels},c=G(this.processedData,s,i);this.containerEl.appendChild(c),this.cleanupInteractions=j({app:this.app,entries:this.processedData.entries,containerEl:c})}};var k=class extends X.Plugin{async onload(){this.registerBasesView("heatmap",{name:"Heatmap",icon:"calendar-heat",factory:(n,t)=>new C(n,t),options:()=>[{type:"property",key:"dateProperty",displayName:"Date property",placeholder:"Use filename for daily notes"},{type:"property",key:"valueProperty",displayName:"Value property"},{type:"text",key:"startDate",displayName:"Start date",placeholder:"YYYY-MM-DD (leave empty for auto)"},{type:"text",key:"endDate",displayName:"End date",placeholder:"YYYY-MM-DD (leave empty for today)"},{type:"dropdown",key:"colorScheme",displayName:"Color scheme",default:"green",options:{green:"Green",purple:"Purple",blue:"Blue",orange:"Orange",gray:"Gray"}},{type:"dropdown",key:"weekStart",displayName:"Week starts on",default:"0",options:{0:"Sunday",1:"Monday"}},{type:"toggle",key:"showWeekdayLabels",displayName:"Show weekday labels",default:!0},{type:"toggle",key:"showMonthLabels",displayName:"Show month labels",default:!0},{type:"text",key:"minValue",displayName:"Min value",placeholder:"Auto (based on data)"},{type:"text",key:"maxValue",displayName:"Max value",placeholder:"Auto (based on data)"}]})}onunload(){}};
