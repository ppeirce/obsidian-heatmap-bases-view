{"id":"obsidian-heatmap-bases-view-0go","title":"Integration tests for interactions","description":"Test click handlers, keyboard navigation, tooltips. Requires DOM mocking.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-26T11:06:01.459646-08:00","updated_at":"2025-12-26T11:06:01.459646-08:00","labels":["integration","testing"],"dependencies":[{"issue_id":"obsidian-heatmap-bases-view-0go","depends_on_id":"obsidian-heatmap-bases-view-bws","type":"parent-child","created_at":"2025-12-26T11:06:36.76269-08:00","created_by":"peter"}]}
{"id":"obsidian-heatmap-bases-view-1fr","title":"Cache color interpolation calculations","description":"`interpolateColor()` performs full Oklab conversion for every cell with no caching.\n\n**Current code (src/colorUtils.ts:177-191):**\n```typescript\nexport function interpolateColor(color1: string, color2: string, t: number): string\n```\n\n**Problem:**\n- Called once per cell during render\n- With 365+ cells, runs complex Oklab math ~365 times\n- Same color pairs computed repeatedly\n\n**Solutions:**\n- Pre-compute color palette for discrete intensity levels (e.g., 10 levels)\n- Cache results for color1+color2 pairs\n- Memoize the function with a Map cache","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-26T10:48:55.62755-08:00","updated_at":"2025-12-26T10:48:55.62755-08:00","labels":["performance"]}
{"id":"obsidian-heatmap-bases-view-4n6","title":"Add custom color scheme support for heatmaps","description":"Allow users to define custom colors for heatmap visualization instead of being limited to the preset color schemes.\n\n**Current behavior:**\nUsers can only choose from predefined color schemes (green, blue, purple, etc.) configured in `src/colorUtils.ts`.\n\n**Requested feature:**\n- Allow users to pick custom colors for the heatmap gradient\n- Options could include:\n  - Custom \"low\" color (empty/zero values)\n  - Custom \"high\" color (max values)\n  - Optionally a mid-point color for more control\n\n**Implementation considerations:**\n- Add color picker inputs to the Bases view config\n- Store custom colors in view configuration\n- Integrate with existing `interpolateColor()` which uses Oklab for smooth gradients\n- Consider adding a 'custom' option to the existing color scheme dropdown\n- May want to add this to plugin settings for a default custom scheme\n\n**UI options:**\n1. Simple: Two color pickers (low + high)\n2. Advanced: Three color pickers (low + mid + high)\n3. Full: Gradient editor with multiple stops\n\n**Related files:**\n- `src/colorUtils.ts` - color schemes and interpolation\n- `src/HeatmapView.ts` - config handling\n- `src/types.ts` - ColorScheme type definition","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-26T10:52:12.349161-08:00","updated_at":"2025-12-26T10:52:12.349161-08:00","labels":["enhancement","ux"]}
{"id":"obsidian-heatmap-bases-view-75p","title":"Fix circular import by reorganizing utilities","description":"`src/interactions.ts` cannot import from `dateUtils.ts` without creating circular dependencies, forcing code duplication.\n\n**Current workaround (src/interactions.ts:189-194):**\n```typescript\n// Reimplemented locally to avoid circular imports\nfunction formatDateISO(date: Date): string {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return \\`\\${year}-\\${month}-\\${day}\\`;\n}\n```\n\n**Problem:**\n- Code duplication creates maintenance burden\n- Risk of implementations diverging\n- Pattern becomes harder to maintain as codebase grows\n\n**Solution:**\n- Create a `utils/` subdirectory with independent utilities\n- Move pure utility functions to avoid domain-aware module coupling\n- Ensure no circular dependencies in new structure","status":"open","priority":1,"issue_type":"chore","created_at":"2025-12-26T10:48:02.662562-08:00","updated_at":"2025-12-26T10:48:02.662562-08:00","labels":["architecture","high-priority","refactor"]}
{"id":"obsidian-heatmap-bases-view-7g2","title":"Update outdated dependencies","description":"Several dependencies are outdated in `package.json`.\n\n**Issues found:**\n\n1. **@types/node: ^16.11.6**\n   - Node 16 is EOL\n   - Should update to `^20.x` for current LTS\n   - Could cause type errors in build tools\n\n2. **esbuild: 0.17.3**\n   - Current version is 0.21+\n   - Pinned version works reliably\n   - Consider updating for security fixes\n\n**Action:**\n```bash\nnpm update @types/node\nnpm update esbuild\n```\n\nThen verify build still works.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-26T10:49:51.135089-08:00","updated_at":"2025-12-26T10:49:51.135089-08:00","labels":["dependencies","maintenance"]}
{"id":"obsidian-heatmap-bases-view-bud","title":"Add JSDoc comments to exported functions","description":"Exported functions lack JSDoc documentation, making the API harder to understand.\n\n**Example - current (src/data.ts):**\n```typescript\nexport function processData(\n    entries: BasesEntry[],\n    dateProperty: string,\n    valueProperty: string\n): ProcessedData\n```\n\n**Should be:**\n```typescript\n/**\n * Process BasesEntry results into heatmap data.\n * \n * Extracts dates and values from entries, computing statistics for\n * intensity scaling. When multiple entries share a date, keeps the\n * one with the highest value.\n * \n * @param entries - Array of BasesEntry objects from query\n * @param dateProperty - Property name for dates or '__filename__'\n * @param valueProperty - Property name to visualize\n * @returns ProcessedData with entries map and computed statistics\n */\n```\n\n**Files to document:**\n- src/data.ts - processData(), extractDate(), extractValue()\n- src/colorUtils.ts - interpolateColor(), getColorScheme()\n- src/dateUtils.ts - parseISODateString(), formatDateISO()\n- src/renderer.ts - renderHeatmap(), createCellElement()","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-26T10:49:56.398723-08:00","updated_at":"2025-12-26T10:49:56.398723-08:00","labels":["documentation"]}
{"id":"obsidian-heatmap-bases-view-bws","title":"Add unit test coverage","description":"The project has zero test coverage. This is a critical gap that should be addressed.\n\n**Scope:**\n- Add unit tests for data processing functions (src/data.ts)\n- Test date parsing edge cases (timezone issues, invalid formats, leap years)\n- Test color interpolation algorithm correctness (src/colorUtils.ts)\n- Test interaction handlers (click, keyboard navigation)\n- Integration tests for Bases view lifecycle\n\n**Recommended Setup:**\n```bash\nnpm install --save-dev vitest @testing-library/dom\n```\n\n**High-value test targets:**\n1. `processData()` - missing values, null handling, duplicate dates\n2. `parseISODateString()` - multiple patterns, edge cases\n3. `interpolateColor()` - Oklab conversion correctness\n4. View lifecycle - data updates, config changes, cleanup","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T10:47:22.730079-08:00","updated_at":"2025-12-26T11:03:13.720678-08:00","labels":["high-priority","testing"]}
{"id":"obsidian-heatmap-bases-view-cva","title":"Add error handling for date parsing with user feedback","description":"Date parsing in `src/data.ts` fails silently when invalid dates are encountered. Users have no way to know why dates disappeared from their heatmap.\n\n**Current behavior (src/data.ts:34-64):**\n```typescript\nconst parsed = parseISODateString(dateStr) ?? new Date(dateStr);\nreturn !isNaN(parsed.getTime()) ? formatDateISO(parsed) : null;\n```\n\n**Problem:**\n- No logging when date parsing fails\n- Users won't know why dates are missing\n- Silent data loss potential\n\n**Solution:**\n- Add try-catch with meaningful error messages\n- Consider console.warn for invalid dates\n- Optionally show count of skipped entries in UI","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-26T10:47:28.010717-08:00","updated_at":"2025-12-26T10:47:28.010717-08:00","labels":["error-handling","high-priority"]}
{"id":"obsidian-heatmap-bases-view-cz8","title":"Unit tests for colorUtils.ts","description":"Test interpolateColor(), getColorScheme(), rgbToHex/hexToRgb, Oklab conversions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T11:05:56.176934-08:00","updated_at":"2025-12-26T11:05:56.176934-08:00","labels":["testing"],"dependencies":[{"issue_id":"obsidian-heatmap-bases-view-cz8","depends_on_id":"obsidian-heatmap-bases-view-bws","type":"parent-child","created_at":"2025-12-26T11:06:31.491544-08:00","created_by":"peter"}]}
{"id":"obsidian-heatmap-bases-view-jq8","title":"Add type guards for DOM event targets","description":"Type assertions are used without validation for DOM event targets.\n\n**Current code (src/interactions.ts:24):**\n```typescript\nconst target = event.target as HTMLElement;\n```\n\n**Problem:**\n- Assumes `event.target` is always HTMLElement\n- No guard clause to verify\n- Could fail if target is null or different type\n\n**Better approach:**\n```typescript\nconst target = event.target;\nif (!(target instanceof HTMLElement)) return;\n// Now TypeScript knows target is HTMLElement\n```\n\n**Other locations to check:**\n- Any `as HTMLElement` casts in interactions.ts\n- Event handler type assertions","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-26T10:50:01.674676-08:00","updated_at":"2025-12-26T10:50:01.674676-08:00","labels":["type-safety"]}
{"id":"obsidian-heatmap-bases-view-lt4","title":"Unit tests for dateUtils.ts","description":"Test parseISODateString(), formatDateISO(), generateDateRange() - formats, edge cases, leap years.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T11:05:50.899632-08:00","updated_at":"2025-12-26T11:05:50.899632-08:00","labels":["testing"],"dependencies":[{"issue_id":"obsidian-heatmap-bases-view-lt4","depends_on_id":"obsidian-heatmap-bases-view-bws","type":"parent-child","created_at":"2025-12-26T11:06:26.208242-08:00","created_by":"peter"}]}
{"id":"obsidian-heatmap-bases-view-m49","title":"Add error feedback when file opening fails","description":"File opening operations in `src/interactions.ts` use `void` to suppress the promise but provide no error feedback if opening fails.\n\n**Affected code (src/interactions.ts:32, 70):**\n```typescript\nvoid app.workspace.openLinkText(notePath, '', false);\n```\n\n**Problem:**\n- User clicks a cell but nothing happens\n- No feedback about the failure\n- Frustrating user experience\n\n**Solution:**\n- Add .catch() handler to show notice on failure\n- Use Obsidian's Notice API for user feedback\n- Log error for debugging","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-26T10:48:45.074934-08:00","updated_at":"2025-12-26T10:48:45.074934-08:00","labels":["error-handling","ux"]}
{"id":"obsidian-heatmap-bases-view-spi","title":"Unit tests for data.ts","description":"Test processData(), extractDate(), extractValue() - edge cases, null handling, duplicates.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T11:05:45.623883-08:00","updated_at":"2025-12-26T11:05:45.623883-08:00","labels":["testing"],"dependencies":[{"issue_id":"obsidian-heatmap-bases-view-spi","depends_on_id":"obsidian-heatmap-bases-view-bws","type":"parent-child","created_at":"2025-12-26T11:06:20.943552-08:00","created_by":"peter"}]}
{"id":"obsidian-heatmap-bases-view-up8","title":"Add tooltip accessibility for keyboard users","description":"Tooltips only appear on hover, making them inaccessible to keyboard users.\n\n**Current code (src/interactions.ts:49-50):**\n```typescript\nconst tooltipContent = buildTooltipContent(dateStr, entries.get(dateStr), cell, plugin);\nsetTooltip(cell, tooltipContent, { placement: 'top' });\n```\n\n**Problem:**\n- Keyboard users navigating with arrow keys can't see tooltips\n- Important information (date, value, color) not accessible\n- Violates WCAG guidelines\n\n**Solutions:**\n- Show tooltip on focus event (not just hover)\n- Add `aria-label` attribute with same content\n- Or use `aria-describedby` pointing to tooltip element","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-26T10:49:06.177409-08:00","updated_at":"2025-12-26T10:49:06.177409-08:00","labels":["accessibility","ux"]}
{"id":"obsidian-heatmap-bases-view-wfy","title":"Add config value validation","description":"Config values are parsed without validation in `src/HeatmapView.ts`.\n\n**Current code (lines 40-43, 51):**\n```typescript\nconst minValue = minValueStr ? parseFloat(minValueStr) : null;\nconst maxValue = maxValueStr ? parseFloat(maxValueStr) : null;\nweekStart: parseInt(config.get('weekStart') as string || '0', 10) as 0 | 1,\n```\n\n**Problems:**\n- `parseFloat()` returns `NaN` for invalid strings, not caught\n- Invalid config values silently become `null`\n- `as 0 | 1` cast assumes valid input without checking\n- Corrupted settings could cause unexpected behavior\n\n**Solution:**\n- Add validation layer for config parsing\n- Check `isNaN()` immediately after parsing\n- Validate weekStart is actually 0 or 1\n- Show user-friendly error for invalid config","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-26T10:49:11.450406-08:00","updated_at":"2025-12-26T10:49:11.450406-08:00","labels":["error-handling","robustness"]}
{"id":"obsidian-heatmap-bases-view-wg9","title":"Optimize DOM queries in interaction setup","description":"DOM query runs on every cell setup, which is inefficient for large heatmaps.\n\n**Current code (src/interactions.ts:85-88):**\n```typescript\nconst cells = containerEl.querySelectorAll('.heatmap-cell');\ncells.forEach(cell =\u003e {\n    (cell as HTMLElement).tabIndex = 0;\n});\n```\n\n**Problems:**\n- `querySelectorAll()` traverses entire DOM tree\n- Runs on every render\n- Inefficient for thousands of cells\n- Type assertion on each iteration\n\n**Solutions:**\n- Set `tabindex` during cell creation in renderer.ts\n- Or use CSS: `.heatmap-cell { tabindex: 0; }` (if supported)\n- Use DocumentFragment for batch DOM operations","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-26T10:48:50.354168-08:00","updated_at":"2025-12-26T10:48:50.354168-08:00","labels":["performance"]}
{"id":"obsidian-heatmap-bases-view-xgi","title":"Set up testing infrastructure","description":"Set up vitest, config, and npm scripts for testing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T11:05:40.333007-08:00","updated_at":"2025-12-26T11:13:22.792375-08:00","closed_at":"2025-12-26T11:13:22.792375-08:00","close_reason":"Closed","labels":["infrastructure","testing"],"dependencies":[{"issue_id":"obsidian-heatmap-bases-view-xgi","depends_on_id":"obsidian-heatmap-bases-view-bws","type":"parent-child","created_at":"2025-12-26T11:06:15.671625-08:00","created_by":"peter"}]}
{"id":"obsidian-heatmap-bases-view-yi7","title":"Refactor HeatmapView.render() into smaller methods","description":"The `render()` method in `src/HeatmapView.ts:69-173` is 105 lines with mixed responsibilities.\n\n**Current responsibilities:**\n- Configuration validation\n- Data processing\n- Empty state detection (4 different cases)\n- Date range calculation\n- Interaction setup\n\n**Suggested refactor:**\nBreak into focused methods:\n- `validateConfig()` - check config values are valid\n- `processData()` - transform entries for rendering\n- `renderEmptyState()` - handle various empty states\n- `setupInteractions()` - wire up click/keyboard handlers\n\nThis improves:\n- Testability (smaller units)\n- Readability\n- Maintainability","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-26T10:49:00.906189-08:00","updated_at":"2025-12-26T10:49:00.906189-08:00","labels":["architecture","refactor"]}
